<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Primordial Life â€” Estado</title>
<style>
  :root{--bg:#f4f6f8;--card:#fff;--accent:#25D366;--muted:#666}
  body{margin:0;font-family:system-ui,Arial;background:var(--bg);color:#111}
  header{background:#075E54;color:#fff;padding:14px;font-weight:600}
  .wrap{max-width:980px;margin:18px auto;padding:12px}
  .grid{display:grid;grid-template-columns:1fr 320px;gap:14px}
  .card{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  h3{margin:0 0 8px 0}
  .bar{height:14px;background:#eee;border-radius:8px;overflow:hidden}
  .bar > i{display:block;height:100%;background:linear-gradient(90deg,#25D366,#1fae4a);width:0%}
  .muted{color:var(--muted);font-size:13px}
  .small{font-size:13px;color:#444}
  .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
  ul{padding-left:18px;margin:8px 0}
  .badge{background:#eee;padding:6px 10px;border-radius:999px;font-weight:600}
  footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
</style>
</head>
<body>
<header>ðŸŒ± Primordial Life â€” Estado</header>
<div class="wrap">
  <div class="grid">
    <div>
      <div class="card" id="mainCard">
        <h3 id="title">Estado de la IA</h3>
        <div class="small muted" id="versionLine">Cargando...</div>
        <hr/>
        <div>
          <strong>ParÃ¡metros mentales</strong>
          <div style="margin-top:8px">
            <div class="small">Curiosidad <span id="curiosityVal" style="float:right">-</span></div>
            <div class="bar" style="margin-bottom:8px"><i id="curiosityBar"></i></div>
            <div class="small">Coherencia <span id="coherenceVal" style="float:right">-</span></div>
            <div class="bar"><i id="coherenceBar"></i></div>
          </div>
        </div>

        <hr/>
        <div>
          <strong>Memoria</strong>
          <p class="muted small">Corta: <span id="shortMem">0</span> â€” Larga: <span id="longMem">0</span></p>
        </div>

        <hr/>
        <div>
          <strong>Nivel evolutivo</strong>
          <p id="evoLevel" style="font-size:16px;font-weight:600;margin:6px 0">â€”</p>
        </div>

        <hr/>
        <div>
          <strong>Ãšltimo resumen</strong>
          <p id="lastSummary" class="small muted">â€”</p>
        </div>
      </div>

      <div style="height:14px"></div>

      <div class="card">
        <h3>Acciones rÃ¡pidas</h3>
        <div class="row" style="margin-bottom:8px">
          <button onclick="doSumm()" style="padding:8px 10px;border-radius:8px;border:none;background:#1976d2;color:#fff;cursor:pointer">Crear resumen</button>
          <button onclick="refreshNow()" style="padding:8px 10px;border-radius:8px;border:1px solid #ccc;background:#fff;cursor:pointer">Refrescar</button>
        </div>
        <div class="muted small">TambiÃ©n puedes ver <a href="/proposals" target="_blank">propuestas</a> o usar endpoints /actions.</div>
      </div>
    </div>

    <aside>
      <div class="card">
        <h3>InformaciÃ³n rÃ¡pida</h3>
        <p class="small muted">Persona: <span id="persona">â€”</span></p>
        <p class="small muted">VersiÃ³n: <span id="version">â€”</span></p>
        <p class="small muted">Propuestas: <span id="propTotal">0</span> (aplicadas: <span id="propApplied">0</span>)</p>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <h3>Registro reciente</h3>
        <div id="logList" class="muted small">Cargando...</div>
      </div>
    </aside>
  </div>

  <footer>ActualizaciÃ³n automÃ¡tica cada 3 segundos Â· Primordial Life</footer>
</div>

<script>
async function fetchStatus(){
  try{
    const r = await fetch('/status');
    if(!r.ok) throw new Error('no status');
    const j = await r.json();

    // encabezados
    document.getElementById('persona').innerText = j.persona || 'â€”';
    document.getElementById('version').innerText = j.version || 'â€”';
    document.getElementById('versionLine').innerText = 'VersiÃ³n ' + (j.version || 'â€”');

    // mental
    const curiosity = Math.round((j.mental_parameters.curiosity||0)*100);
    const coherence = Math.round((j.mental_parameters.coherence||0)*100);
    document.getElementById('curiosityVal').innerText = curiosity + '%';
    document.getElementById('coherenceVal').innerText = coherence + '%';
    document.getElementById('curiosityBar').style.width = (curiosity) + '%';
    document.getElementById('coherenceBar').style.width = (coherence) + '%';

    // memoria
    document.getElementById('shortMem').innerText = j.memory.short_memory_entries || 0;
    document.getElementById('longMem').innerText = j.memory.long_memory_entries || 0;

    // nivel / summary
    document.getElementById('evoLevel').innerText = j.evolution_level || 'â€”';
    document.getElementById('lastSummary').innerText = j.last_summary || 'No se encontrÃ³ resumen reciente.';

    // propuestas
    document.getElementById('propTotal').innerText = j.proposals.total || 0;
    document.getElementById('propApplied').innerText = j.proposals.applied || 0;

    // log (muestra Ãºltimas 6 entradas de memoria corta como registro rÃ¡pido)
    const sm = window._lastShort = (j._short_sample || null);
    if(!sm){
      // pedir una muestra simple al endpoint /state (no es ideal, pero rÃ¡pido)
      const rs = await fetch('/state');
      if(rs.ok){
        const st = await rs.json();
        const last = (st.short_memory || []).slice(-6).reverse().map(x=>'<div>'+ (x.text ? x.text.substring(0,120) : JSON.stringify(x)) +'</div>');
        document.getElementById('logList').innerHTML = last.join('');
      } else {
        document.getElementById('logList').innerText = 'No hay registro';
      }
    } else {
      document.getElementById('logList').innerHTML = sm.map(x=>'<div>'+x+'</div>').join('');
    }

  }catch(e){
    console.warn('status error', e);
  }
}

async function doSumm(){
  document.getElementById('lastSummary').innerText = 'Generando resumen...';
  const r = await fetch('/actions/summarize', {method:'POST'});
  const j = await r.json();
  document.getElementById('lastSummary').innerText = j.result || 'No se pudo generar.';
  setTimeout(fetchStatus, 1000);
}

function refreshNow(){ fetchStatus(); }

fetchStatus();
setInterval(fetchStatus, 3000);
</script>
</body>
</html>
