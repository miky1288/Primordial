<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Primordial Life â€” Chat</title>
<style>
:root{--green:#25D366;--bg:#ece5dd;--white:#fff}
body{margin:0;background:var(--bg);font-family:system-ui,Arial}
.header{background:#075E54;color:white;padding:14px;font-weight:600}
.wrap{max-width:900px;margin:10px auto;background:transparent}
.chat{background:var(--bg);height:70vh;overflow:auto;padding:20px;display:flex;flex-direction:column;gap:10px}
.msg{max-width:70%;padding:10px;border-radius:12px}
.user{align-self:flex-end;background:var(--green);color:#063;border:none;color:#000}
.ia{align-self:flex-start;background:var(--white);color:#000}
.inputbar{display:flex;gap:8px;padding:12px;max-width:900px;margin:0 auto}
#txt{flex:1;padding:12px;border-radius:24px;border:none;outline:none}
.btn{background:var(--green);border:none;color:white;padding:10px 14px;border-radius:20px;cursor:pointer}
.footer{font-size:12px;color:#444;padding:8px;text-align:center}
</style>
</head>
<body>
<div class="header">ðŸŒ± Primordial Life â€” Chat</div>
<div class="wrap">
  <div id="chat" class="chat"></div>
  <div class="inputbar">
    <input id="txt" placeholder="Escribe un mensaje..." autocomplete="off"/>
    <button id="snd" class="btn">Enviar</button>
  </div>
  <div class="footer">IA evolutiva â€” Nivel 3 (propuestas controladas)</div>
</div>

<script>
const chat = document.getElementById('chat');
const txt = document.getElementById('txt');
const btn = document.getElementById('snd');

function addBubble(text, kind){
  const d = document.createElement('div');
  d.className = 'msg ' + (kind==='user' ? 'user' : 'ia');
  d.innerText = text;
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

async function send(){
  const message = txt.value.trim();
  if(!message) return;
  addBubble(message, 'user');
  txt.value = '';
  try{
    const r = await fetch('/ask',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message})});
    const j = await r.json();
    addBubble(j.response || 'Sin respuesta', 'ia');
  }catch(e){
    addBubble('Error al contactar al servidor','ia');
  }
}

btn.onclick = send;
txt.addEventListener('keydown', (e)=>{ if(e.key==='Enter') send(); });
</script>
</body>
</html>
