<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>IA Chat - WhatsApp Style</title>

<style>
body {
    margin: 0;
    padding: 0;
    font-family: Arial;
    background: #e5ddd5;
}

#chat-container {
    width: 100%;
    height: 100vh;
    display: flex;
    flex-direction: column;
}

#header {
    background: #075E54;
    color: white;
    padding: 15px;
    font-size: 20px;
    font-weight: bold;
}

#messages {
    flex: 1;
    padding: 20px;
    overflow-y: scroll;
    display: flex;
    flex-direction: column;
}

.message {
    max-width: 70%;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 10px;
}

.user {
    background: #DCF8C6;
    align-self: flex-end;
}

.ia {
    background: white;
    align-self: flex-start;
}

#input-area {
    display: flex;
    padding: 10px;
    background: #f0f0f0;
}

#msg {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 20px;
    outline: none;
    font-size: 16px;
}

#send {
    margin-left: 10px;
    padding: 10px 20px;
    background: #25D366;
    border: none;
    color: white;
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
}
</style>
</head>

<body>

<div id="chat-container">
    <div id="header">IA Evolutiva</div>

    <div id="messages"></div>

    <div id="input-area">
        <input id="msg" placeholder="Escribe un mensaje..." />
        <button id="send">Enviar</button>
    </div>
</div>

<script>
async function sendMessage() {
    const msg = document.getElementById("msg").value;
    if (!msg) return;

    const messages = document.getElementById("messages");

    // User bubble
    const userBubble = document.createElement("div");
    userBubble.className = "message user";
    userBubble.innerText = msg;
    messages.appendChild(userBubble);

    messages.scrollTop = messages.scrollHeight;
    document.getElementById("msg").value = "";

    // Send to backend
    const res = await fetch("/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: msg })
    });

    const data = await res.json();

    // IA bubble
    const iaBubble = document.createElement("div");
    iaBubble.className = "message ia";
    iaBubble.innerText = data.response;
    messages.appendChild(iaBubble);

    messages.scrollTop = messages.scrollHeight;
}

document.getElementById("send").onclick = sendMessage;

// Press Enter
document.getElementById("msg").addEventListener("keydown", (e) => {
    if (e.key === "Enter") sendMessage();
});
</script>

</body>
</html>
